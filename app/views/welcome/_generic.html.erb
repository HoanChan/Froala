<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
		<meta name="keywords" content="math,science" />
		<link rel="stylesheet" type="text/css" href="demo_style.css" />
		<script type="text/javascript" src="./generic_wiris/core/display.js"></script>
		<script type="text/javascript" src="./generic_wiris/wirisplugin-generic.js"></script>
		<!-- <script type="text/javascript" src="./assets/wirispluginengine//WIRISplugins.js?viewer=image"></script> -->
		<title>Plugin WIRIS integration on ruby | Educational mathematics</title>

		<script type="text/javascript">
			// Retrieve language from either URL or POST parameters
			function getParameter(name,dflt) {
				var value = new RegExp(name+"=([^&]*)","i").exec(window.location);
				if (value!=null && value.length>1) return decodeURIComponent(value[1].replace(/\+/g,' ')); else return dflt;
			}
		    var lang = getParameter("language","<%= params[:language].to_s.blank? ? "" : params[:language].html_safe %>");
			if (lang.length==0) lang="en";
		</script>
		
		<style>
			#iconsDiv {display:inline-block;}
			#langFormDiv { display:inline-block; margin-left:640px;}
		</style>
		<!--[if IE]><style>#langFormDiv { margin-left:640px; }</style><![endif]-->
		<!--[if lt IE 9]><style>#langFormDiv { margin-left:645px; }</style><![endif]-->
		<!--[if lt IE 8]><style>#iconsDiv {display:inline;zoom:1; margin-bottom:-20px;} #langFormDiv { display:inline; zoom:1; margin-bottom:-20px;}</style><![endif]-->		
		
	</head>

	<body>
		<h1>Generic HTML editor WIRIS integration on PHP</h1>
		
		<div id="languages">Try it with different technologies:</div><br/>
		
		<ul id="buttons">
			<li><a class="button" href="http://www.wiris.com/plugins/editors/download?filter=generic2">Download plugin</a></li>
			<li><a class="button" href="http://www.wiris.com/plugins/docs/demo-download?filter=generic2">Download this demo</a></li>
			<li><a class="button" href="http://www.wiris.com/plugins/docs/generic2">Documentation</a></li>
			<li><a href="http://www.wiris.com/plugins/demo/generic2/php"><img class="tech" src="http://www.wiris.com/themes/wiris_com/plugins/php_45.png" title="PHP Demo" /></a></li>
            <li><a href="http://www.wiris.com/plugins/demo/generic2/aspx"><img class="tech" src="http://www.wiris.com/themes/wiris_com/plugins/aspnet_45.png" title="ASPX Demo" /></a></li>
           	<li><a href="http://www.wiris.com/plugins/demo/generic2/java"><img class="tech" src="http://www.wiris.com/themes/wiris_com/plugins/java_45.png" title="Java Demo" /></a></li>
		</ul>

		<form name="langForm" id="exampleForm" method="POST">
			<h2>New icons in the editor</h2>
			<div id="iconsDiv">		
				<ul id="icons">
					<li><img src="generic_wiris/icons/formula.png" /> WIRIS editor</li>
					<li><img src="generic_wiris/icons/cas.png" /> WIRIS cas</li>
				</ul>
			</div>
			<div id="langFormDiv">
				<select id="language" name="language" onchange="this.form.submit()">
					<option value="ar">Arabic</option><option value="eu">Basque</option><option value="ca">Catalan</option>
					<option value="zh-tw">Chinese</option><option value="hr">Croatian</option><option value="cs">Czech</option>
					<option value="da">Danish</option><option value="nl">Dutch</option><option value="en" selected="true">English</option>
					<option value="et">Estonian</option><option value="fi">Finnish</option><option value="fr">French</option>
					<option value="gl">Galician</option><option value="de">German</option><option value="he">Hebrew</option>
					<option value="hu">Hungarian</option><option value="it">Italian</option><option value="ja">Japanese</option>
					<option value="ko">Korean</option><option value="no">Norwegian</option><option value="pl">Polish</option>
					<option value="pt">Portuguese</option><option value="ru">Russian</option><option value="es">Spanish</option>
					<option value="sv">Swedish</option><option value="tr">Turkish</option>				
				</select>
				<script>
					// Select the option using the "lang" variable
					if (lang.length>0) {
						sel = document.getElementById("language");
						for (i=0;i<sel.length;i++) {
							if (sel.options[i].value==lang) {
								sel.selectedIndex=i;
								break;
							}
						}
					}
				</script>
			</div>
			<br />
			<textarea id="example" name="content" cols="50" rows="15">&nbsp;<%= params[:content].to_s.blank? ? "" : params[:content].html_safe %></textarea>
			
			<input id="previewButton" type="submit" value="Preview"/>
			<script type="text/javascript">
				function wrs_addEvent(element, event, func) {
					if (element.addEventListener) {
						element.addEventListener(event, func, false);
					}
					else if (element.attachEvent) {
						element.attachEvent('on' + event, func);
					}
				}

				wrs_addEvent(window, 'load', function () {
					// Hide the textarea
					var textarea = document.getElementById('example');
					textarea.style.display = 'none';

					// Create the toolbar
					var toolbar = document.createElement('div');
					toolbar.id = textarea.id + '_toolbar';

					// Disable WIRIS chemistry editor.
					_wrs_conf_chemEnabled = false;
					
					// Create the WYSIWYG editor
					var iframe = document.createElement('iframe');
					iframe.id = textarea.id + '_iframe';
					
					wrs_addEvent(iframe, 'load', function () {
						// Setting design mode ON
						iframe.contentWindow.document.designMode = 'on';
						
						// Setting the content
						if (iframe.contentWindow.document.body) {
							iframe.contentWindow.document.body.innerHTML = textarea.value;
						
							// WE INIT THE WIRIS PLUGIN HERE
							wrs_int_init(iframe,toolbar);
						}
					});

					iframe.src = 'generic_wiris/tests/generic_demo.html';		// We set an empty document instead of about:blank for use relative paths for images
					iframe.width = 500;
					iframe.height = 200;

					// Insert the WYSIWYG editor before the textarea
					textarea.parentNode.insertBefore(iframe, textarea);
					
					// Insert the toolbar before the WYSIWYG editor
					iframe.parentNode.insertBefore(toolbar, iframe);
					
					// When the user submits the form, set the textarea value with the WYSIWYG editor content
					var form = document.getElementById('exampleForm');
					
					wrs_addEvent(form, 'submit', function () {
						// WE CALL THE PLUGIN HERE
						textarea.value = wrs_endParse(iframe.contentWindow.document.body.innerHTML);
					});
				});
				
				function changeDPI() {
					ls = document.getElementsByClassName('Wirisformula');
					for (i=0;i<ls.length;i++) {
						img = ls[i];
						img.width = img.clientWidth;
						img.src = img.src + "&dpi=600";
					}
				}
			</script>
		</form>
		
		<h2>Preview</h2>
		
		<div id="previewBox"><%= params[:content].to_s.blank? ? "" : params[:content].html_safe %></div>
		

		<div id="logo">
			<a href="http://www.wiris.com"><img src="http://www.wiris.com/en/system/files/attachments/889/wiris_50.png" title="WIRIS" /></a>
		</div>

		<script type="text/javascript">
			// Set initial text and directionality for the preview panel
			var content = document.getElementById('previewBox').innerHTML;
			if (content.length==0) {
				document.getElementById('previewBox').innerHTML = '<span id="previewMessage">Press the "Preview" button.</span>'
			}
			if (content.length>0 && (lang == 'ar' || lang == 'he')) {
				var prevBox = document.getElementById('previewBox');
				prevBox.setAttribute('dir', 'rtl');
			}			
		</script>	

		<script src="google_analytics.js"></script>
		<script>
			var js = document.createElement("script");
			js.type = "text/javascript";
			js.src = "./assets/wirispluginengine//WIRISplugins.js?viewer=image";
			document.head.appendChild(js);
		</script>
	</body>
</html>
